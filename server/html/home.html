<!doctype html>
<html ng-app="rpnow">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, height=device-height, maximum-scale=1, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <title>RPNow</title>
  <meta name="description" content="RPNow is a roleplay site where small groups of friends can instantly create private roleplaying chatrooms.">

  <base href="/">
</head>

<body>

  <div ng-view ng-cloak></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular-route.js"></script>
  <script src="rprandom.js"></script>
  <script>
    angular.module('rpnow', ['ngRoute']);

    angular.module('rpnow')

    .config(['$locationProvider', '$routeProvider', function($locationProvider, $routeProvider) {
      $locationProvider.html5Mode(true);

      $routeProvider
        .when('/', {
          templateUrl: '/app/home.template.html',
          controller: 'NewRpController'
        })
        .when('/rp/:rpCode', {
          template: 'RP page here...'
        })
        .otherwise('/');
    }])

    .controller('NewRpController', ['$scope', '$timeout', '$http', '$location', function($scope, $timeout, $http, $location) {
      var spinTimer = null;
      function tick(millis) {
        $scope.title = RPRandom.shortTitle(25);
        if (millis < 200.0) spinTimer = $timeout(tick, millis, true, millis * 1.2);
      }
      $scope.spinTitle = function() {
        if (spinTimer) $timeout.cancel(spinTimer);
        tick(1.0);
      };

      $scope.submit = function() {
        $scope.submitted = true;
        $http.post('/api/v1/rps.json', {title: $scope.title, desc: $scope.desc})
          .then(function(res) {
            $scope.rpCode = res.data.rpCode;
            $location.url('/rp/'+$scope.rpCode);
          })
      }
    }])
  </script>
</body>
</html>