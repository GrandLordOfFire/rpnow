<!doctype html>
<html ng-app="rpnow">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, height=device-height, maximum-scale=1, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <title>RPNow</title>
  <meta name="description" content="RPNow is a roleplay site where small groups of friends can instantly create private roleplaying chatrooms.">
</head>

<body ng-controller="NewRpController">
  <h1>RPNow</h1>
  <form ng-hide="submitted" ng-submit="submit()">
    <fieldset>
      <input type="text" ng-model="title" maxlength="30" placeholder="Type a Title..." required autocomplete="off">
      <button type="button" ng-click="spinTitle()">Random</button>
    </fieldset>
    <fieldset ng-show="showMoreOptions">
      <textarea ng-model="desc" maxlength="255" placeholder="Enter a Description... (Optional)" autocomplete=off></textarea>
    </fieldset>
    <fieldset>
      <input type="submit" value="Begin Roleplay"></input>
      <button type="button" ng-hide="showMoreOptions" ng-click="showMoreOptions = true">More options</button>
    </fieldset>
  </form>

  <div ng-show="submitted">
    <span ng-hide="rpCode">Creating RP...</span>
    <span ng-show="rpCode">RP Created: {{rpCode}}</span>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.js"></script>
  <script src="rprandom.js"></script>
  <script>
    angular.module('rpnow', [])

    .controller('NewRpController', ['$scope', '$timeout', '$http', function($scope, $timeout, $http) {
      var spinTimer = null;
      function tick(millis) {
        $scope.title = RPRandom.shortTitle(25);
        if (millis < 200.0) spinTimer = $timeout(tick, millis, true, millis * 1.2);
      }
      $scope.spinTitle = function() {
        if (spinTimer) $timeout.cancel(spinTimer);
        tick(1.0);
      };

      $scope.submit = function() {
        $scope.submitted = true;
        $http.post('/api/v1/rps.json', {title: $scope.title, desc: $scope.desc})
          .then(function(res) {
            $scope.rpCode = res.data.rpCode;
            window.location.href = 'rp/'+$scope.rpCode;
          })
      }
    }])
  </script>
</body>
</html>