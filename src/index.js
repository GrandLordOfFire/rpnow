const config = require('./services/config');
const checkIfAlreadyRunning = require('./services/is-already-running');
const bannerMessage = require('./services/cli-banner-message');
const app = require('./app');

function showError(str) {
    console.error(str);
    if (process.pkg) setInterval(() => {}, 10000); // In desktop app mode, keep the process alive
    else process.exit(1); // In command line mode, exit with error code
}

checkIfAlreadyRunning().then(isRunning => {
    if (isRunning) return showError('ERROR: RPNow is already running');

    app.listen(config.port, (err) => {
        if (err) return showError(`ERROR: RPNow failed to start: ${err}`);

        // delay logging this until messages generated by vue-pronto are done
        setTimeout(() => console.log(bannerMessage), 2000);
    });
})
