<div [ngClass]="classes" [style.background-color]="chara?.color||''" [style.color]="(chara?.color|bw)">
    <div *ngIf="chara" class="name">{{chara.name}}</div>

    <div class="message-details" *ngIf="!editing && options.showMessageDetails">
        <ng-container *ngIf="sending">
            <mat-spinner [diameter]="16"></mat-spinner>
        </ng-container>
        <ng-container *ngIf="!sending">
            <span class="timestamp" [timeAgo]="msg.createdAt" [timeAgoEdited]="msg.editedAt"></span>
            <ipid *ngIf="msg.ipid" [style.visibility]="canEdit()?'hidden':'visible'" [ipid]="msg.ipid"></ipid>
        </ng-container>
    </div>

    <div *ngIf="canEdit() && !sending" class="action-buttons">
        <ng-container *ngIf="!editing">
            <button mat-icon-button (click)="beginEdit()">
                <mat-icon aria-label="Edit post" matTooltip="Edit post">edit</mat-icon>
            </button>
        </ng-container>
        <ng-container *ngIf="editing">
            <button mat-icon-button [disabled]="!validEdit()" (click)="confirmEdit()">
                <mat-icon aria-label="Save edits" matTooltip="Save edits">save</mat-icon>
            </button>
            <button mat-icon-button (click)="cancelEdit()">
                <mat-icon aria-label="Discard edits" matTooltip="Discard edits">cancel</mat-icon>
            </button>
        </ng-container>
    </div>

    <ng-container *ngIf="msg.type !== 'image' && !editing">
        <div class="content generated-links" [innerHtml]="msg.content|msgFormat:chara?.color"></div>
    </ng-container>

    <ng-container *ngIf="editing">
        <textarea class="content" [(ngModel)]="newContent" maxlength="10000" rows="4" (keypress)="keypressCheckEnter($event)"></textarea>
    </ng-container>

    <ng-container *ngIf="msg.type === 'image'">
        <div class="content">
            <a [href]="msg.url" target="_blank">
                <img [src]="msg.url"/>
            </a>
        </div>
    </ng-container>
</div>